{% import "macros/planet.html" as planet_macros %}
{% import "macros/star.html" as star_macros %}


{% macro chatline(star) %}
<li class="list-group-item">
    {{ star_macros.oneup(star) }}
    <span>
        <a href="{{ url_for('web.star', id=star.id) }}"><span class="author_name">{{ star.author.username }}</span> {{star.created|localtime|naturaltime}} </a>
        {{ star.text|markdown(autolink=True, no_intra_emphasis=True, space_headers=True, safelink=True, skip_html=True) }}
    </span>
</li>

{% for planet_assoc in star.planet_assocs %}
<li class="list-group-item rk-chat-planet">
    {{ planet_macros.planet(planet_assoc.planet, scale=True, size='small') }}
</li>
{% endfor %}

{% endmacro %}


{% macro chat(map, title="Chat") %}
<div class="rk-chat panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">{{ title }}</h3>
    </div>

    <div class="panel-body" id="rk-chat-meta">
        <!-- <div id="rk-chat-nicknames"></div> -->
        <p id="rk-chat-connecting">Connecting to Glia chat</p>
    </div>

    <ul class="list-group" id="rk-chat-lines">
        {% for star in map.index.filter_by(state=0) %}
        {{ chatline(star) }}
        {% endfor %}
    </ul>

    <div class="panel-footer">
    <form id="send-message" class="form-inline">
        <input id="message" autocomplete="off" class="form-control input-sm">
        <button class="btn btn-sm rk-chat-button" data-loading-text='<i class="fa fa-circle-o-notch fa-spin"></i>' autocomplete="off">Send</button>
    </form>
    </div>
</div> <!-- ./ panel -->

{% endmacro%}
